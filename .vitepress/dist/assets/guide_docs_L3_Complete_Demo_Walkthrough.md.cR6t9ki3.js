import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.dvv-DFtf.js";const o=JSON.parse('{"title":"L3 Complete Lifecycle Demo Walkthrough","description":"","frontmatter":{},"headers":[],"relativePath":"guide/docs/L3_Complete_Demo_Walkthrough.md","filePath":"guide/docs/L3_Complete_Demo_Walkthrough.md","lastUpdated":null}'),t={name:"guide/docs/L3_Complete_Demo_Walkthrough.md"};function e(h,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="l3-complete-lifecycle-demo-walkthrough" tabindex="-1">L3 Complete Lifecycle Demo Walkthrough <a class="header-anchor" href="#l3-complete-lifecycle-demo-walkthrough" aria-label="Permalink to &quot;L3 Complete Lifecycle Demo Walkthrough&quot;">​</a></h1><p>本教程将带你走完 AAstar 协议的完整生命周期，包括社区创建、运营商入驻、用户加入以及免 Gas 交易。</p><h2 id="场景概述" tabindex="-1">场景概述 <a class="header-anchor" href="#场景概述" aria-label="Permalink to &quot;场景概述&quot;">​</a></h2><p>在这个 Demo 中，我们模拟两个角色：</p><ol><li><strong>Alice (社区领袖 &amp; 运营商)</strong>: 她创建一个名为 &quot;AliceDAO&quot; 的社区，并运行一个 SuperPaymaster 节点来为她的成员通过赞助。</li><li><strong>Bob (终端用户)</strong>: 他加入 Alice 的社区，获得 SBT 身份，并发送一笔由 Alice 赞助的免 Gas 交易。</li></ol><h2 id="源码位置" tabindex="-1">源码位置 <a class="header-anchor" href="#源码位置" aria-label="Permalink to &quot;源码位置&quot;">​</a></h2><p>你可以从 SDK 仓库中找到该完整示例： <code>examples/for-iri/ts/src/l3-lifecycle-demo.ts</code></p><hr><h2 id="核心步骤解析" tabindex="-1">核心步骤解析 <a class="header-anchor" href="#核心步骤解析" aria-label="Permalink to &quot;核心步骤解析&quot;">​</a></h2><h3 id="_1-社区创建-community-launch" tabindex="-1">1. 社区创建 (Community Launch) <a class="header-anchor" href="#_1-社区创建-community-launch" aria-label="Permalink to &quot;1. 社区创建 (Community Launch)&quot;">​</a></h3><p>Alice 使用 <code>CommunityClient</code> 一键启动社区。这会自动完成角色注册、xPNTs 代币部署和信誉规则初始化。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aliceCommunity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CommunityClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aliceCommunity.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setupCommunity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AliceDAO&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tokenSymbol: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ALICE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stakeAmount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseEther</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;30&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 质押 30 GToken 启动社区</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="_2-运营商入驻-operator-onboarding" tabindex="-1">2. 运营商入驻 (Operator Onboarding) <a class="header-anchor" href="#_2-运营商入驻-operator-onboarding" aria-label="Permalink to &quot;2. 运营商入驻 (Operator Onboarding)&quot;">​</a></h3><p>Alice 决定作为 SuperPaymaster 运营商，为社区提供 Gas 代付服务。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aliceOperator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OperatorLifecycle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 一键完成：质押 GToken + 注册角色 + 存入 Gas 备用金</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aliceOperator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setupNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SUPER&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stakeAmount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseEther</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;50&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    depositAmount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseEther</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;100&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配置支持的代币和收益提现地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aliceOperator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configureOperator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xPNTsToken, aliceAcc.address, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseEther</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><h3 id="_3-用户加入-user-onboarding" tabindex="-1">3. 用户加入 (User Onboarding) <a class="header-anchor" href="#_3-用户加入-user-onboarding" aria-label="Permalink to &quot;3. 用户加入 (User Onboarding)&quot;">​</a></h3><p>Bob 发现 Alice 的社区很棒，决定加入。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bobL3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserLifecycle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 检查是否满足加入条件，然后执行一键 onboard</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bobL3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkEligibility</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aliceAddr)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bobL3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onboard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aliceAddr, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseEther</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0.4&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 质押少量 GToken 并铸造 SBT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_4-免-gas-交易-gasless-transaction" tabindex="-1">4. 免 Gas 交易 (Gasless Transaction) <a class="header-anchor" href="#_4-免-gas-交易-gasless-transaction" aria-label="Permalink to &quot;4. 免 Gas 交易 (Gasless Transaction)&quot;">​</a></h3><p>Bob 现在是社区成员了，他发送交易时无需支付 native ETH。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> userOpHash</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SuperPaymasterClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">submitGaslessTransaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    publicClient,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bobClient,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bobAA,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entryPoint,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bundlerUrl,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        token: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GTOKEN_ADDRESS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        recipient: aliceAddr,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        amount: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseEther</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        operator: aliceAddr, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 指定由 Alice 的节点赞助</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        paymasterAddress: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SUPER_PAYMASTER</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_5-退出流程-exit-phase" tabindex="-1">5. 退出流程 (Exit Phase) <a class="header-anchor" href="#_5-退出流程-exit-phase" aria-label="Permalink to &quot;5. 退出流程 (Exit Phase)&quot;">​</a></h3><p>最后，Bob 离开社区，Alice 撤出运营商资金。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Bob 离开</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bobL3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">leaveCommunity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aliceAddr);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Alice 撤资（受协议锁定期限制）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aliceOperator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withdrawAllFunds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><hr><h2 id="如何运行" tabindex="-1">如何运行 <a class="header-anchor" href="#如何运行" aria-label="Permalink to &quot;如何运行&quot;">​</a></h2><ol><li>配置 <code>examples/for-iri/ts/.env</code> 文件，确保包含必要的合约地址和私钥。</li><li>安装依赖：<code>pnpm install</code></li><li>执行 Demo：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/l3-lifecycle-demo.ts</span></span></code></pre></div></li></ol><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>免 Gas 交易步骤需要配置有效的 Bundler URL (如 Pimlico 或 Alchemy)。如果仅在本地 Anvil 测试，该步骤可能会因为缺乏 Bundler 环境而跳过。</p></div>`,28)])])}const c=i(t,[["render",e]]);export{o as __pageData,c as default};
