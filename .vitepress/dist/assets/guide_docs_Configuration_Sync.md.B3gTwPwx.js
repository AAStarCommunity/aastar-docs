import{_ as a,c as i,o,ag as t}from"./chunks/framework.dvv-DFtf.js";const p=JSON.parse('{"title":"SDK & Contract Repository Configuration Sync","description":"","frontmatter":{},"headers":[],"relativePath":"guide/docs/Configuration_Sync.md","filePath":"guide/docs/Configuration_Sync.md","lastUpdated":1769265003000}'),s={name:"guide/docs/Configuration_Sync.md"};function n(r,e,c,d,l,h){return o(),i("div",null,[...e[0]||(e[0]=[t('<h1 id="sdk-contract-repository-configuration-sync" tabindex="-1">SDK &amp; Contract Repository Configuration Sync <a class="header-anchor" href="#sdk-contract-repository-configuration-sync" aria-label="Permalink to &quot;SDK &amp; Contract Repository Configuration Sync&quot;">​</a></h1><p>This document outlines the synchronization mechanism between the <code>SuperPaymaster</code> (Contracts) repository and the <code>aastar-sdk</code>.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The SDK relies on two artifacts from the contract repository:</p><ol><li><strong>ABIs</strong>: JSON files defining the contract interfaces.</li><li><strong>Configuration</strong>: JSON files defining deployed contract addresses and source code verification hashes.</li></ol><h2 id="sync-workflow" tabindex="-1">Sync Workflow <a class="header-anchor" href="#sync-workflow" aria-label="Permalink to &quot;Sync Workflow&quot;">​</a></h2><p>The synchronization is automated via the <code>run_sdk_complete_regression.sh</code> script (and standalone <code>sync_to_sdk.sh</code> in SuperPaymaster).</p><h3 id="_1-artifact-generation-superpaymaster-side" tabindex="-1">1. Artifact Generation (SuperPaymaster Side) <a class="header-anchor" href="#_1-artifact-generation-superpaymaster-side" aria-label="Permalink to &quot;1. Artifact Generation (SuperPaymaster Side)&quot;">​</a></h3><ul><li><strong>ABIs</strong>: <code>forge build</code> generates artifacts. <code>extract_v3_abis.sh</code> extracts verified ABIs to <code>abis/*.json</code>.</li><li><strong>Config</strong>: Deployment scripts (e.g., <code>DeployAnvil.s.sol</code>) generate <code>deployments/config.{network}.json</code>. This file includes: <ul><li>Contract Addresses (Registry, SuperPaymaster, etc.)</li><li><code>srcHash</code>: SHA-256 hash of the <code>contracts/src</code> directory for integrity checks.</li></ul></li></ul><h3 id="_2-synchronization-bridge" tabindex="-1">2. Synchronization Bridge <a class="header-anchor" href="#_2-synchronization-bridge" aria-label="Permalink to &quot;2. Synchronization Bridge&quot;">​</a></h3><p>Artifacts are copied to the SDK:</p><ul><li><code>abis/*.json</code> -&gt; <code>packages/core/src/abis/</code></li><li><code>deployments/config.{network}.json</code> -&gt; <code>config.{network}.json</code> (SDK Root)</li></ul><h3 id="_3-sdk-abstraction-layer-constants-ts" tabindex="-1">3. SDK Abstraction Layer (<code>constants.ts</code>) <a class="header-anchor" href="#_3-sdk-abstraction-layer-constants-ts" aria-label="Permalink to &quot;3. SDK Abstraction Layer (`constants.ts`)&quot;">​</a></h3><p>The SDK avoids hardcoding addresses or reading JSON files directly in business logic.</p><ul><li><strong>File</strong>: <code>packages/core/src/constants.ts</code></li><li><strong>Mechanism</strong>: <ul><li>Reads <code>process.env.NETWORK</code> (default: &#39;anvil&#39;).</li><li>Dynamically loads <code>config.{network}.json</code>.</li><li>Exports constants like <code>REGISTRY_ADDRESS</code>, <code>SUPER_PAYMASTER_ADDRESS</code>.</li></ul></li><li><strong>Legacy Support</strong>: <code>contract-addresses.ts</code> has been refactored to consume <code>constants.ts</code>, ensuring backward compatibility.</li></ul><h3 id="_4-canonical-address-solidification-v0-16-16" tabindex="-1">4. Canonical Address Solidification (V0.16.16+) <a class="header-anchor" href="#_4-canonical-address-solidification-v0-16-16" aria-label="Permalink to &quot;4. Canonical Address Solidification (V0.16.16+)&quot;">​</a></h3><p>To support NPM distribution where root JSON files are unavailable, the SDK now includes a built-in address registry.</p><ul><li><strong>File</strong>: <code>packages/core/src/addresses.ts</code></li><li><strong>Mechanism</strong>: <ul><li>Hardcoded defaults for Sepolia (Chain ID 11155111) and OP Sepolia (Chain ID 11155420).</li><li><code>constants.ts</code> use these as a third-level fallback after ENV and Local JSON.</li></ul></li><li><strong>Benefit</strong>: Users installing via <code>@aastar/sdk</code> get a &quot;plug-and-play&quot; experience on supported networks.</li></ul><h2 id="sdk-release-integrity-lifecycle" tabindex="-1">SDK Release Integrity Lifecycle <a class="header-anchor" href="#sdk-release-integrity-lifecycle" aria-label="Permalink to &quot;SDK Release Integrity Lifecycle&quot;">​</a></h2><p>To ensure verifiable releases, the SDK uses an automated SHA-256 integrity hash system.</p><h3 id="_1-generation-update-version-sh" tabindex="-1">1. Generation (<code>update-version.sh</code>) <a class="header-anchor" href="#_1-generation-update-version-sh" aria-label="Permalink to &quot;1. Generation (`update-version.sh`)&quot;">​</a></h3><p>When upgrading the version, the script automatically:</p><ul><li>Calculates a stable hash of all source files (excluding <code>.md</code>).</li><li>Synchronizes this hash into <code>README.md</code>, <code>CHANGELOG.md</code>, and this document.</li><li>The hash is also included in the Git Tag metadata.</li></ul><h3 id="_2-guarding-publish-sh" tabindex="-1">2. Guarding (<code>publish.sh</code>) <a class="header-anchor" href="#_2-guarding-publish-sh" aria-label="Permalink to &quot;2. Guarding (`publish.sh`)&quot;">​</a></h3><p>Before publishing to NPM, the script:</p><ul><li>Re-calculates the actual code hash.</li><li>Compares it with the &quot;Official&quot; hash recorded in <code>README.md</code>.</li><li>Blocks the release if any code was modified after the last version update.</li></ul><p><strong>Current Code Integrity Hash (v0.16.16)</strong>: <code>b7a6229407d2fbc2b7308e84c711ed41ff6ee8498a29b9ace0207ac4efbb10c8</code><em>(Excludes metadata/markdown to ensure stability)</em></p><h2 id="verification-verify-onchain-milestone-ts" tabindex="-1">Verification (<code>verify_onchain_milestone.ts</code>) <a class="header-anchor" href="#verification-verify-onchain-milestone-ts" aria-label="Permalink to &quot;Verification (`verify_onchain_milestone.ts`)&quot;">​</a></h2><p>A verification script (<code>scripts/verify_onchain_milestone.ts</code>) ensures the SDK is in sync with the chain:</p><ol><li>Loads <code>config.{network}.json</code> via <code>constants.ts</code>.</li><li>Verifies <code>srcHash</code> existence.</li><li>Checks on-chain code presence for all critical contracts using <code>viem</code>.</li></ol><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h2><p>To run the full regression with sync and verification:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./run_sdk_complete_regression.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> anvil</span></span></code></pre></div>',33)])])}const g=a(s,[["render",n]]);export{p as __pageData,g as default};
